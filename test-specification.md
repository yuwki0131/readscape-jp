# Readscape-JP Consumer API テスト仕様書

## 概要
Readscape-JP Consumer API の機能を検証するための包括的なテスト仕様書です。

## テスト環境
- **Base URL**: `http://localhost:8080`
- **認証方式**: JWT認証
- **テストデータ**: `data.sql`に定義されたサンプルデータを使用

## テストユーザー
| ユーザー | メール | パスワード | ロール |
|---------|--------|-----------|-------|
| consumer1 | consumer1@readscape.jp | hello | CONSUMER |
| manager1 | manager1@readscape.jp | hello | MANAGER |
| admin1 | admin1@readscape.jp | hello | ADMIN |

## テストケース一覧

### 1. 認証機能テスト

#### 1.1 ユーザーログイン
- **エンドポイント**: `POST /api/users/login`
- **目的**: 有効な認証情報でJWTトークンを取得
- **テストデータ**: consumer1ユーザー
- **期待結果**:
  - ステータスコード: 200
  - レスポンスにtokenフィールドが含まれる

#### 1.2 無効なログイン
- **エンドポイント**: `POST /api/users/login`
- **目的**: 無効な認証情報でエラーレスポンスを確認
- **テストデータ**: 存在しないユーザー
- **期待結果**:
  - ステータスコード: 401 または 403

### 2. 書籍閲覧機能テスト

#### 2.1 書籍一覧取得
- **エンドポイント**: `GET /api/books`
- **目的**: 書籍一覧の取得
- **期待結果**:
  - ステータスコード: 200
  - レスポンス形式: JSON配列
  - 各書籍オブジェクトに必須フィールド（id, title, author, price, category, rating）が含まれる

#### 2.2 書籍一覧取得（カテゴリーフィルタ）
- **エンドポイント**: `GET /api/books?category=技術書`
- **目的**: カテゴリーでフィルタリングした書籍一覧の取得
- **期待結果**:
  - ステータスコード: 200
  - 技術書カテゴリーの書籍のみが返される

#### 2.3 書籍一覧取得（キーワード検索）
- **エンドポイント**: `GET /api/books?keyword=Spring`
- **目的**: キーワードで検索した書籍一覧の取得
- **期待結果**:
  - ステータスコード: 200
  - "Spring"を含む書籍のみが返される

#### 2.4 書籍一覧取得（ページネーション）
- **エンドポイント**: `GET /api/books?page=0&size=3`
- **目的**: ページネーション機能の確認
- **期待結果**:
  - ステータスコード: 200
  - 最大3件の書籍が返される

#### 2.5 書籍詳細取得
- **エンドポイント**: `GET /api/books/1`
- **目的**: 指定したIDの書籍詳細情報を取得
- **期待結果**:
  - ステータスコード: 200
  - 書籍詳細情報（id, title, author, price, category, description, rating, reviews）が含まれる

#### 2.6 存在しない書籍詳細取得
- **エンドポイント**: `GET /api/books/999`
- **目的**: 存在しない書籍IDでのエラーレスポンス確認
- **期待結果**:
  - ステータスコード: 404

### 3. カート機能テスト（認証必須）

#### 3.1 カート内容取得
- **エンドポイント**: `GET /api/cart`
- **目的**: 現在のカート内容を取得
- **認証**: 必須（JWTトークン）
- **期待結果**:
  - ステータスコード: 200
  - カート情報（items, totalPrice）が含まれる

#### 3.2 カートに書籍追加
- **エンドポイント**: `POST /api/cart`
- **目的**: カートに書籍を追加
- **認証**: 必須（JWTトークン）
- **リクエストボディ**: `{"bookId": 1, "quantity": 2}`
- **期待結果**:
  - ステータスコード: 200
  - 成功メッセージが返される

#### 3.3 カート内書籍数量変更
- **エンドポイント**: `PUT /api/cart/1`
- **目的**: カート内の書籍数量を変更
- **認証**: 必須（JWTトークン）
- **リクエストボディ**: `{"quantity": 3}`
- **期待結果**:
  - ステータスコード: 200
  - 成功メッセージが返される

#### 3.4 カートから書籍削除
- **エンドポイント**: `DELETE /api/cart/1`
- **目的**: カートから書籍を削除
- **認証**: 必須（JWTトークン）
- **期待結果**:
  - ステータスコード: 200
  - 成功メッセージが返される

### 4. 注文機能テスト（認証必須）

#### 4.1 注文作成
- **エンドポイント**: `POST /api/orders`
- **目的**: カート内の商品を基に注文を作成
- **認証**: 必須（JWTトークン）
- **前提条件**: カートに商品が追加されていること
- **リクエストボディ**: `{"paymentMethod": "credit_card", "address": "123 Main Street, Tokyo"}`
- **期待結果**:
  - ステータスコード: 200
  - 注文ID（orderId）と成功メッセージが返される

#### 4.2 注文履歴取得
- **エンドポイント**: `GET /api/orders`
- **目的**: ログイン中ユーザーの注文履歴を取得
- **認証**: 必須（JWTトークン）
- **期待結果**:
  - ステータスコード: 200
  - 注文履歴の配列が返される

#### 4.3 注文詳細取得
- **エンドポイント**: `GET /api/orders/{orderId}`
- **目的**: 指定した注文の詳細を取得
- **認証**: 必須（JWTトークン）
- **期待結果**:
  - ステータスコード: 200
  - 注文詳細情報が返される

### 5. ユーザープロフィール機能テスト（認証必須）

#### 5.1 プロフィール取得
- **エンドポイント**: `GET /api/users/profile`
- **目的**: ログイン中ユーザーのプロフィール情報を取得
- **認証**: 必須（JWTトークン）
- **期待結果**:
  - ステータスコード: 200
  - ユーザー情報（username, email）が含まれる

#### 5.2 プロフィール更新
- **エンドポイント**: `PUT /api/users/profile`
- **目的**: ユーザーのプロフィール情報を更新
- **認証**: 必須（JWTトークン）
- **リクエストボディ**: `{"username": "updated_user", "email": "updated_user@example.com"}`
- **期待結果**:
  - ステータスコード: 200
  - 成功メッセージが返される

### 6. レビュー機能テスト

#### 6.1 レビュー一覧取得
- **エンドポイント**: `GET /api/books/1/reviews`
- **目的**: 指定した書籍のレビュー一覧を取得
- **期待結果**:
  - ステータスコード: 200
  - レビューの配列が返される

#### 6.2 レビュー投稿
- **エンドポイント**: `POST /api/books/1/reviews`
- **目的**: 書籍にレビューを投稿
- **認証**: 必須（JWTトークン）
- **リクエストボディ**: `{"rating": 5, "comment": "Amazing book!"}`
- **期待結果**:
  - ステータスコード: 200
  - 成功メッセージが返される

### 7. 認証なしアクセステスト

#### 7.1 認証が必要なエンドポイントへの未認証アクセス
- **エンドポイント**: `GET /api/cart`
- **目的**: JWTトークンなしでのアクセス時のエラー確認
- **期待結果**:
  - ステータスコード: 401

## 検証項目

### レスポンス検証
1. **ステータスコード**: 期待されるHTTPステータスコードが返される
2. **レスポンス形式**: JSONフォーマットが正しい
3. **必須フィールド**: 期待されるフィールドが含まれている
4. **データ型**: フィールドのデータ型が正しい
5. **データ値**: 期待される値が設定されている

### セキュリティ検証
1. **認証制御**: 認証が必要なエンドポイントで適切にアクセス制御される
2. **JWT検証**: 有効なJWTトークンでのみアクセスできる
3. **権限制御**: ユーザーロールに応じた適切なアクセス制御

### 機能検証
1. **CRUD操作**: 作成、読取、更新、削除の各操作が正常に動作する
2. **検索・フィルタ**: 検索とフィルタリング機能が正常に動作する
3. **ページネーション**: ページング機能が正常に動作する
4. **関連性**: エンティティ間の関連性が正しく処理される

## 注意事項
- テスト実行前にアプリケーションが起動していることを確認
- テストデータがデータベースに正しく投入されていることを確認
- 各テストケースは独立して実行可能でなければならない
- テスト実行順序に依存しないよう設計する