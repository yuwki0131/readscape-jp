# 1.5 API インターフェース

## 概要
RESTful な設計原則に基づく、消費者向けと管理者向けの包括的なAPI インターフェース仕様です。

## 消費者向けエンドポイント

### 書籍閲覧API
```
GET /api/books
  - クエリパラメータ: category, keyword, page, size
  - レスポンス: BookSummary[]

GET /api/books/{id}
  - パスパラメータ: id (書籍ID)
  - レスポンス: BookDetail

GET /api/books/search
  - クエリパラメータ: q (検索キーワード), category, page, size
  - レスポンス: SearchResult<BookSummary>
```

### カート管理API
```
GET /api/cart
  - 認証: 必須
  - レスポンス: CartResponse

POST /api/cart
  - 認証: 必須
  - リクエスト: AddToCartRequest
  - レスポンス: ApiResponse

PUT /api/cart/{bookId}
  - 認証: 必須
  - リクエスト: UpdateCartQuantityRequest
  - レスポンス: ApiResponse

DELETE /api/cart/{bookId}
  - 認証: 必須
  - レスポンス: ApiResponse
```

### 注文管理API
```
POST /api/orders
  - 認証: 必須
  - リクエスト: CreateOrderRequest
  - レスポンス: CreateOrderResponse

GET /api/orders
  - 認証: 必須
  - レスポンス: OrderSummary[]

GET /api/orders/{id}
  - 認証: 必須
  - レスポンス: OrderDetail
```

### ユーザー管理API
```
POST /api/users/register
  - リクエスト: RegisterUserRequest
  - レスポンス: ApiResponse

POST /api/users/login
  - リクエスト: LoginRequest
  - レスポンス: LoginResponse

GET /api/users/profile
  - 認証: 必須
  - レスポンス: UserProfile

PUT /api/users/profile
  - 認証: 必須
  - リクエスト: UpdateProfileRequest
  - レスポンス: ApiResponse
```

### レビューAPI
```
GET /api/books/{bookId}/reviews
  - レスポンス: Review[]

POST /api/books/{bookId}/reviews
  - 認証: 必須
  - リクエスト: PostReviewRequest
  - レスポンス: ApiResponse
```

## 管理者向けエンドポイント

### 書籍管理API
```
GET /api/admin/books
  - 認証: ADMIN/MANAGER
  - クエリパラメータ: page, size, status
  - レスポンス: AdminBookView[]

POST /api/admin/books
  - 認証: ADMIN/MANAGER
  - リクエスト: CreateBookRequest
  - レスポンス: CreateBookResponse

PUT /api/admin/books/{id}
  - 認証: ADMIN/MANAGER
  - リクエスト: UpdateBookRequest
  - レスポンス: ApiResponse

DELETE /api/admin/books/{id}
  - 認証: ADMIN
  - レスポンス: ApiResponse
```

### 在庫管理API
```
GET /api/admin/inventory
  - 認証: ADMIN/MANAGER
  - レスポンス: InventoryItem[]

POST /api/admin/inventory/{bookId}/stock
  - 認証: ADMIN/MANAGER
  - リクエスト: StockUpdateRequest
  - レスポンス: ApiResponse

GET /api/admin/inventory/low-stock
  - 認証: ADMIN/MANAGER
  - レスポンス: LowStockItem[]
```

### 注文管理API
```
GET /api/admin/orders
  - 認証: ADMIN/MANAGER
  - クエリパラメータ: status, page, size
  - レスポンス: AdminOrderView[]

PUT /api/admin/orders/{id}/status
  - 認証: ADMIN/MANAGER
  - リクエスト: UpdateOrderStatusRequest
  - レスポンス: ApiResponse
```

### 分析API
```
GET /api/admin/analytics/sales
  - 認証: ADMIN/ANALYST
  - クエリパラメータ: start_date, end_date, granularity
  - レスポンス: SalesAnalytics

GET /api/admin/analytics/books/popular
  - 認証: ADMIN/ANALYST
  - クエリパラメータ: period, limit
  - レスポンス: PopularBook[]
```

## DTOクラス

### リクエストDTO
```java
// 例: カート追加リクエスト
@Data
@Valid
public class AddToCartRequest {
    @NotNull
    @Positive
    private Long bookId;
    
    @NotNull
    @Min(1)
    @Max(99)
    private Integer quantity;
}
```

### レスポンスDTO
```java
// 例: 書籍詳細レスポンス
@Data
public class BookDetail {
    private Long id;
    private String title;
    private String author;
    private String isbn;
    private Integer price;
    private String category;
    private String description;
    private Integer stockQuantity;
    private Double averageRating;
    private List<Review> reviews;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```

## バリデーション

### 入力値検証
- Bean Validation アノテーション活用
- カスタムバリデーター実装
- 複合的なビジネスルール検証
- 国際化対応エラーメッセージ

### エラーハンドリング
```java
// 統一エラーレスポンス
@Data
public class ApiErrorResponse {
    private String error;
    private String message;
    private Integer status;
    private LocalDateTime timestamp;
    private String path;
    private List<FieldError> fieldErrors;
}
```

### HTTPステータスコード
- 200 OK: 正常処理
- 201 Created: リソース作成成功
- 400 Bad Request: 入力値エラー
- 401 Unauthorized: 認証エラー
- 403 Forbidden: 認可エラー
- 404 Not Found: リソース未発見
- 409 Conflict: 競合エラー
- 500 Internal Server Error: サーバーエラー

## API設計原則

### RESTful設計
- リソース指向URL設計
- HTTPメソッドの適切な使用
- ステートレス通信
- HATEOAS対応（将来拡張）

### セキュリティ
- HTTPS必須
- JWT トークン認証
- CORS設定
- レート制限
- SQL インジェクション対策

### パフォーマンス
- ページネーション実装
- 適切なHTTPキャッシュヘッダー
- gzip圧縮対応
- 非同期処理（長時間処理）

## 技術仕様
- フレームワーク: Spring Boot 3.x + Spring Web
- バリデーション: Spring Boot Validation + Bean Validation
- シリアライゼーション: Jackson
- ドキュメント: OpenAPI 3.0 + Springdoc
- テスト: Spring Boot Test + MockMvc